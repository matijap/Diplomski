!function(a){"use strict";function b(d){this.options=a.extend({},b.defaults,d),this.ens=".slb"+ ++c,this.init()}var c=0,d=a("html"),e=a(document),f=a(window);b.defaults={elementClass:"",htmlClass:"slbActive",closeBtnClass:"",nextBtnClass:"",prevBtnClass:"",loadingClass:"",closeBtnCaption:"Close",nextBtnCaption:"Next",prevBtnCaption:"Previous",loadingCaption:"Loading...",bindToItems:!0,closeOnOverlayClick:!0,nextOnImageClick:!0,showCaptions:!0,captionAttribute:"title",urlAttribute:"href",startAt:0,loadingTimeout:100,appendTarget:a("body"),beforeSetContent:null,beforeClose:null,beforeDestroy:null,videoRegex:new RegExp(/youtube.com|vimeo.com/)},a.extend(b.prototype,{items:[],captions:[],init:function(){var b=this;this.options.$items?(this.$items=this.options.$items,this.$items.each(function(){var c=a(this);b.items.push(c.attr(b.options.urlAttribute)),b.captions.push(c.attr(b.options.captionAttribute))}),this.options.bindToItems&&this.$items.on("click"+this.ens,function(c){c.preventDefault(),b.showPosition(b.$items.index(a(c.currentTarget)))})):this.options.items&&(this.items=this.options.items),this.options.captions&&(this.captions=this.options.captions)},next:function(){return this.showPosition(this.currentPosition+1)},prev:function(){return this.showPosition(this.currentPosition-1)},normalizePosition:function(a){return a>=this.items.length?a=0:0>a&&(a=this.items.length-1),a},showPosition:function(a){return this.currentPosition=this.normalizePosition(a),this.setupLightboxHtml().prepareItem(this.currentPosition,this.setContent).show()},prepareItem:function(b,c){var d=this,e=this.items[b];if(this.loadingTimeout=setTimeout(function(){d.setContent('<p class="slbLoading '+d.options.loadingClass+'">'+d.options.loadingCaption+"</p>").show()},this.options.loadingTimeout),this.options.videoRegex.test(e))c.call(d,a('<div class="slbIframeCont"><iframe class="slbIframe" frameborder="0" allowfullscreen src="'+e+'"></iframe></div>'));else{var f=a('<div class="slbImageWrap"><img class="slbImage" src="'+e+'" /></div>');this.$currentImage=f.find(".slbImage"),this.options.showCaptions&&this.captions[b]&&f.append('<div class="slbCaption">'+this.captions[b]+"</div>"),this.loadImage(e,function(){d.setImageDimensions(),c.call(d,f),d.loadImage(d.items[d.normalizePosition(d.currentPosition+1)])})}return this},loadImage:function(a,b){if(!this.options.videoRegex.test(a)){var c=new Image;b&&(c.onload=b),c.src=a}},setupLightboxHtml:function(){var b=this.options;return this.$el||(this.$el=a('<div class="slbElement '+b.elementClass+'"><div class="slbOverlay"></div><div class="slbWrapOuter"><div class="slbWrap"><div class="slbContentOuter"><div class="slbContent"></div><button type="button" title="'+b.closeBtnCaption+'" class="slbCloseBtn '+b.closeBtnClass+'">Ã—</button></div></div></div></div>'),this.items.length>1&&a('<div class="slbArrows"><button type="button" title="'+b.prevBtnCaption+'" class="prev slbArrow'+b.prevBtnClass+'">'+b.prevBtnCaption+'</button><button type="button" title="'+b.nextBtnCaption+'" class="next slbArrow'+b.nextBtnClass+'">'+b.nextBtnCaption+"</button></div>").appendTo(this.$el.find(".slbContentOuter")),this.$content=this.$el.find(".slbContent")),this},show:function(){return this.modalInDom||(this.$el.appendTo(this.options.appendTarget),d.addClass(this.options.htmlClass),this.setupLightboxEvents(),this.modalInDom=!0),this},setContent:function(b){var c=a(b);return clearTimeout(this.loadingTimeout),this.setupLightboxHtml(),this.options.beforeSetContent&&this.options.beforeSetContent(c,this),this.$content.html(c),this},setImageDimensions:function(){this.$currentImage&&this.$currentImage.css("max-height",f.height()+"px")},setupLightboxEvents:function(){var b=this;this.lightboxEventsSetuped||(this.$el.on("click"+this.ens,function(c){var d=a(c.target);d.is(".slbCloseBtn")||b.options.closeOnOverlayClick&&d.is(".slbWrap")?b.close():d.is(".slbArrow")?d.hasClass("next")?b.next():b.prev():b.options.nextOnImageClick&&b.items.length>1&&d.is(".slbImage")&&b.next()}),e.on("keyup"+this.ens,function(a){27===a.keyCode&&b.close(),b.items.length>1&&((39===a.keyCode||68===a.keyCode)&&b.next(),(37===a.keyCode||65===a.keyCode)&&b.prev())}),f.on("resize"+this.ens,function(){b.setImageDimensions()}),this.lightboxEventsSetuped=!0)},close:function(){this.modalInDom&&(this.beforeClose&&this.beforeClose(this),this.$el&&this.$el.off(this.ens),e.off(this.ens),f.off(this.ens),this.lightboxEventsSetuped=!1,this.$el.detach(),d.removeClass(this.options.htmlClass),this.modalInDom=!1)},destroy:function(){this.close(),this.beforeDestroy&&this.beforeDestroy(this),this.$items&&this.$items.off(this.ens),this.$el&&this.$el.remove()}}),b.open=function(a){var c=new b(a);return a.content?c.setContent(a.content).show():c.showPosition(c.options.startAt)},a.fn.simpleLightbox=function(c){var d,e=this;return this.each(function(){a.data(this,"simpleLightbox")||(d=d||new b(a.extend({},c,{$items:e})),a.data(this,"simpleLightbox",d))})},a.simpleLightbox=b}(window.jQuery||window.Zepto||window.simpleQuery);